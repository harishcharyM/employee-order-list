
<script>
  const form = document.getElementById('deviceForm');
  const msg  = document.getElementById('msg');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const username = document.getElementById('username').value.trim();
    const empId    = document.getElementById('empId').value.trim();

    try {
      const res = await fetch('/devices', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, empId })
      });

      let data = {};
      try { data = await res.json(); } catch {}

      if (res.status === 201) {
        localStorage.setItem('login_user_name', username);
        localStorage.setItem('login_emp_id', empId);
        window.location.assign('/menu');
        return;
      }
      msg.textContent = data.error || `Failed (${res.status})`;
    } catch (err) {
      console.error('Save error:', err);
      msg.textContent = 'Network or server error';
    }
  });
</

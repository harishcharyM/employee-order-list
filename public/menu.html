
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Food Menu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#0f0f0f; --card:#1c1c1c; --text:#eee; --accent:#6a5acd; --muted:#aaa; }
    body { font-family: system-ui, sans-serif; background:var(--bg); color:var(--text); margin:0; }
    header { padding:16px 24px; background:#141414; border-bottom:1px solid #222; display:flex; justify-content:space-between; }
    .container { max-width:960px; margin:24px auto; padding:0 16px; }
    .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap:16px; }
    .item { background:var(--card); border:1px solid #2a2a2a; border-radius:12px; padding:16px; }
    .actions { display:flex; align-items:center; justify-content:space-between; margin-top:8px; }
    .btn { background:var(--accent); color:#fff; border:none; border-radius:10px; padding:12px 18px; font-weight:600; cursor:pointer; }
    .msg { margin-top:12px; }
    .overlay { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.6); z-index:50; }
    .panel { background:#1b1b1b; border:1px solid #333; border-radius:14px; padding:20px 24px; max-width:520px; width:92%; text-align:center; }
  </style>
</head>
<body>
  <header>
    <strong>Food Menu</strong>
    <span id="userInfo" style="color:#aaa"></span>
  </header>

  <div class="container">
    <div id="msg" class="msg" aria-live="polite"></div>
    <div id="menuGrid" class="grid"></div>
    <div style="margin-top:16px; display:flex; justify-content:flex-end;">
      <button id="orderBtn" class="btn">Order</button>
    </div>
  </div>

  <div id="overlay" class="overlay">
    <div class="panel">
      <h3>Your Order</h3>
      <ul id="summaryList" style="text-align:left; margin:12px 0; padding-left:20px;"></ul>
      <div id="summaryTotal" style="font-weight:700;"></div>
      <div id="summaryCountdown" style="color:#aaa; font-size:13px;"></div>
    </div>
  </div>

  <script>
    const MENU = [
      { id:'biryani', name:'Hyderabadi Biryani', price:220 },
      { id:'dosa',    name:'Masala Dosa',        price:120 },
      { id:'paneer',  name:'Paneer Butter Masala', price:180 },
      { id:'chicken', name:'Chicken Curry',      price:200 },
      { id:'idli',    name:'Idli (2 pcs)',       price:60  },
      { id:'vada',    name:'Medu Vada (2 pcs)',  price:70  },
      { id:'dal',     name:'Dal Tadka',          price:140 },
      { id:'roti',    name:'Butter Roti (2 pcs)', price:50  },
      { id:'salad',   name:'Green Salad',        price:80  },
      { id:'drink',   name:'Soft Drink',         price:40  },
    ];

    const grid = document.getElementById('menuGrid');
    const msg = document.getElementById('msg');
    const userInfo = document.getElementById('userInfo');
    const overlay = document.getElementById('overlay');
    const summaryList = document.getElementById('summaryList');
    const summaryTotal = document.getElementById('summaryTotal');
    const summaryCountdown = document.getElementById('summaryCountdown');

    function getLoginInfo() {
      return {
        name: localStorage.getItem('login_user_name') || '',
        empId: localStorage.getItem('login_emp_id') || ''
      };
    }

    function renderMenu() {
      const f = document.createDocumentFragment();
      MENU.forEach(it => {
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `
          <h4 style="margin:0;">${it.name}</h4>
          <div style="color:#aaa;">₹${it.price}</div>
          <div class="actions">
            <label>
              <input type="checkbox" class="pick" data-name="${it.name}" data-price="${it.price}"> Add
            </label>
            <span>₹${it.price}</span>
          </div>
        `;
        f.appendChild(div);
      });
      grid.appendChild(f);
    }

    function getSelections() {
      return [...grid.querySelectorAll('input.pick:checked')].map(n => ({
        name: n.dataset.name, price: Number(n.dataset.price)
      }));
    }

    function showOverlay(items) {
      summaryList.innerHTML = '';
      let total = 0;
      items.forEach(it => {
        total += it.price;
        const li = document.createElement('li');
        li.textContent = `${it.name} — ₹${it.price}`;
        summaryList.appendChild(li);
      });
      summaryTotal.textContent = `Total: ₹${total}`;
      overlay.style.display = 'flex';

      let seconds = 10;
      summaryCountdown.textContent = `This summary will close in ${seconds}s…`;
      const timer = setInterval(() => {
        seconds--;
        summaryCountdown.textContent = `This summary will close in ${seconds}s…`;
        if (seconds <= 0) {
          clearInterval(timer);
          overlay.style.display = 'none';
        }
      }, 1000);
    }

    async function sendOrder(payload) {
      const res = await fetch('/orders', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      if (!res.ok || !data.ok) throw new Error(data.error || 'Order publish failed');
    }

    document.getElementById('orderBtn').addEventListener('click', async () => {
      msg.textContent = '';
      const sel = getSelections();
      if (sel.length === 0) {
        msg.textContent = 'Please select at least one item.';
        msg.style.color = '#ff6b6b';
        return;
      }
      const { name, empId } = getLoginInfo();
      if (!name || !empId) {
        msg.textContent = 'Login details missing. Please register again.';
        msg.style.color = '#ff6b6b';
        return;
      }
      const payload = { name, emp_id: empId, order_list: sel.map(i => i.name) };
      showOverlay(sel);
      try {
        await sendOrder(payload);
        msg.textContent = 'Order sent!';
        msg.style.color = '#7CFC00';
      } catch (e) {
        msg.textContent = `Failed: ${e.message}`;
        msg.style.color = '#ff6b6b';
      }
      grid.querySelectorAll('input.pick:checked').forEach(n => n.checked = false);
    });

    // Init
    renderMenu();
    const { name, empId } = getLoginInfo();
    userInfo.textContent = `User: ${name || '—'} (Emp: ${empId || '—'})`;
  </script>
</body>
</
